function main(workbook: ExcelScript.Workbook) {
  // התחלת מדידת זמן
  let startTime = new Date().getTime();
  
  console.log("מתחיל בתהליך הסריקה (עמודות L,M -> N,O)...");

  const sheet = workbook.getActiveWorksheet();
  const usedRange = sheet.getUsedRange();

  if (!usedRange) {
    console.log("הגיליון ריק. מסיים ריצה.");
    return;
  }

  // חישוב גודל הטווח
  const lastRowIndex = usedRange.getLastRow().getRowIndex();
  // סך הכל שורות לעיבוד (מתחילים משורה 2)
  const rowCount = lastRowIndex; 

  if (rowCount < 1) {
    console.log("אין מספיק נתונים לעיבוד (פחות מ-2 שורות).");
    return;
  }

  console.log(`נמצאו ${rowCount} שורות לעיבוד. טוען נתונים לזיכרון...`);

  // --- שינוי הגדרת העמודות ---
  // עמודה L היא אינדקס 11 (A=0, K=10, L=11)
  // עמודה N היא אינדקס 13
  // אנו קוראים בלוק של 2 עמודות בכל פעם:
  // sourceRange = L, M (עמודות 11, 12)
  // targetRange = N, O (עמודות 13, 14)

  const sourceRange = sheet.getRangeByIndexes(1, 11, rowCount, 2); // עמודות מקור L, M
  const targetRange = sheet.getRangeByIndexes(1, 13, rowCount, 2); // עמודות יעד N, O

  // טעינת הערכים
  const sourceValues = sourceRange.getValues();
  const targetValues = targetRange.getValues();

  // הגדרות לוגיקה
  const zPattern = /z/i; // ביטוי רגולרי לחיפוש z (מתעלם מ-Case)
  let hasChanges = false;
  
  // מונים לסטטיסטיקה
  let countChangedN = 0;
  let countChangedO = 0;
  
  // דיווח כל 200 שורות
  const logBatchSize = 200; 

  console.log("הנתונים נטענו בהצלחה, מתחיל בעיבוד השורות...");

  // לולאה ראשית
  for (let i = 0; i < rowCount; i++) {
    
    // שליפת הערכים מהמערך בזיכרון
    // אינדקס 0 במערך המקומי = העמודה השמאלית בטווח (N או L)
    // אינדקס 1 במערך המקומי = העמודה הימנית בטווח (O או M)
    
    let valN = targetValues[i][0]; // הערך הנוכחי בעמודה N
    let valO = targetValues[i][1]; // הערך הנוכחי בעמודה O
    let rowChanged = false;

    // --- בדיקה עבור עמודה N (העתקה מ-L) ---
    if (typeof valN === 'string' && zPattern.test(valN)) {
      targetValues[i][0] = sourceValues[i][0]; // העתקה מ-L
      countChangedN++;
      rowChanged = true;
    }

    // --- בדיקה עבור עמודה O (העתקה מ-M) ---
    if (typeof valO === 'string' && zPattern.test(valO)) {
      targetValues[i][1] = sourceValues[i][1]; // העתקה מ-M
      countChangedO++;
      rowChanged = true;
    }

    // סימון כללי שיש צורך בשמירה בסוף
    if (rowChanged) {
      hasChanges = true;
    }

    // הדפסת התקדמות לקונסול כל 200 שורות
    if ((i + 1) % logBatchSize === 0) {
      console.log(`...מעבד... הושלמו ${i + 1} שורות מתוך ${rowCount}`);
    }
  }

  // שלב השמירה: כותבים לאקסל רק אם באמת בוצע שינוי כלשהו
  if (hasChanges) {
    console.log("סיימתי עיבוד. כותב את השינויים חזרה לאקסל (עמודות N, O)...");
    targetRange.setValues(targetValues);
  } else {
    console.log("לא נמצאה האות 'z' באף תא בעמודות N או O. לא בוצעה כתיבה.");
  }

  // חישוב זמנים וסיכום
  let endTime = new Date().getTime();
  let duration = (endTime - startTime) / 1000; // המרה לשניות

  console.log("-----------------------------------------");
  console.log("             סיכום ביצוע                 ");
  console.log("-----------------------------------------");
  console.log(`סה"כ שורות שנבדקו: ${rowCount}`);
  console.log(`החלפות שבוצעו בעמודה N (מקור L): ${countChangedN}`);
  console.log(`החלפות שבוצעו בעמודה O (מקור M): ${countChangedO}`);
  console.log(`סה"כ החלפות: ${countChangedN + countChangedO}`);
  console.log(`זמן ריצה כולל: ${duration} שניות`);
  console.log("-----------------------------------------");
}
